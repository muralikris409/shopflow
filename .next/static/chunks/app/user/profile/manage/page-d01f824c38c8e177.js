(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[460],{9090:(e,t,a)=>{Promise.resolve().then(a.bind(a,2721))},6046:(e,t,a)=>{"use strict";var r=a(6658);a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},5743:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(5155),s=a(6046),o=a(2115),n=a(3391);let l=e=>t=>{let a=(0,s.useRouter)(),l=(0,n.d4)(e=>e.session.user),[i,d]=(0,o.useState)(!0);return((0,o.useEffect)(()=>{void 0!==l&&d(!1)},[l]),(0,o.useEffect)(()=>{i||l||a.push("/auth")},[i,l,a]),i)?(0,r.jsx)("div",{children:"Loading......."}):l?(0,r.jsx)(e,{...t}):null}},6301:(e,t,a)=>{"use strict";a.d(t,{S:()=>r});let r=a(2651).A.create({baseURL:"https://shopflow-1-ugli.onrender.com"})},1086:(e,t,a)=>{"use strict";a.d(t,{Ad:()=>u,BD:()=>l,E1:()=>m,Hh:()=>n,RW:()=>c,d6:()=>o,iD:()=>s,qk:()=>d,xw:()=>i});var r=a(6301);async function s(e){let{email:t,password:a}=e;try{let{token:e,data:s}=(await r.S.post("user/login",{email:t,password:a})).data;return localStorage.setItem("shopflow_session",JSON.stringify({user:s,token:e})),{data:s,token:e}}catch(e){throw Error(e.response.data.message||"An error occurred during login.")}}async function o(e){try{let t=await r.S.post("user/oauth",{name:e.name,email:e.email,image:e.image,id:e.id}),{token:a,data:s}=t.data;return localStorage.setItem("shopflow_session",JSON.stringify({user:s,token:a})),t.data}catch(e){throw Error(e.response.data.message||"An error occurred during Google OAuth.")}}async function n(e){let{username:t,email:a,password:s}=e;try{return(await r.S.post("user/signup",{name:t,email:a,password:s},{headers:{"Content-Type":"application/json"}})).data}catch(e){throw Error(e.response.data.message||"An error occurred during sign-up.")}}async function l(e){try{var t;let a=await r.S.post("user/forgotPassword?email=".concat(e));if(console.log(a),200===a.status)return{ok:!0,data:a.data};return{ok:!1,message:(null===(t=a.data)||void 0===t?void 0:t.message)||"Something went wrong."}}catch(e){throw console.log(e),e}}async function i(e,t){try{return await r.S.post("user/resetPassword?token=".concat(e,"&newPassword=").concat(t))}catch(e){console.log(e)}}async function d(e,t){try{console.log("test");let a=await r.S.post("user/userProfileInfo?userId=".concat(t),{},{headers:{Authorization:"Bearer ".concat(e)}});return console.log(a),a}catch(e){console.log(e)}}async function c(e,t,a){try{console.log("test");let s=await r.S.post("user/updateUserProfile?userId=".concat(t),a,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"multipart/form-data"}});return console.log(s),s}catch(e){console.log(e)}}async function u(e,t){try{console.log("token",e);let a=await r.S.post("user/getAllAddress?userId=".concat(t),{},{headers:{Authorization:"Bearer ".concat(e)}});return console.log(a),a.data}catch(e){return console.error("Error fetching addresses:",e),{error:e.message||"Something went wrong!"}}}let m=async(e,t,a)=>{try{let{street:s,city:o,state:n,country:l,zip:i,isPrimary:d}=a;return(await r.S.post("user/addAddress",{},{params:{userId:t,street:s,city:o,state:n,country:l,zip:i,isPrimary:d},headers:{Authorization:"Bearer ".concat(e)}})).data}catch(e){var s,o;return console.error("Error adding address:",e),{error:(null===(o=e.response)||void 0===o?void 0:null===(s=o.data)||void 0===s?void 0:s.message)||"Something went wrong!"}}}},2721:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var r=a(5155),s=a(2115),o=a(1086),n=a(3391);let l=(0,a(5743).A)(()=>{let e=(0,n.d4)(e=>{var t,a;return null==e?void 0:null===(a=e.session)||void 0===a?void 0:null===(t=a.user)||void 0===t?void 0:t.id}),t=(0,n.d4)(e=>{var t;return null==e?void 0:null===(t=e.session)||void 0===t?void 0:t.token}),a=(0,n.d4)(e=>{var t;return null==e?void 0:null===(t=e.session)||void 0===t?void 0:t.user}),l=(0,n.d4)(e=>{var t,a;return null==e?void 0:null===(a=e.session)||void 0===a?void 0:null===(t=a.user)||void 0===t?void 0:t.googleId}),[i,d]=(0,s.useState)({name:"",phone:"",profileImage:""}),[c,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(!1),[g,p]=(0,s.useState)(null);(0,s.useEffect)(()=>{let a=async()=>{try{let a=await (0,o.qk)(t,e);console.log(a),d(a.data.data),u(a.data.data.profile_pic)}catch(e){p("Failed to load profile data."),console.error(e)}};e&&t&&a()},[e,t]);let f=e=>{let{name:t,value:a}=e.target;d(e=>({...e,[t]:a}))},v=async r=>{r.preventDefault();let s=new FormData;s.append("name",i.name),s.append("phone",i.phone),i.profileImage&&s.append("profile",i.profileImage),h(!0),p(null);try{let r=await (0,o.RW)(t,e,s);console.log(r),alert("Profile updated successfully!");let n={...a,...null==r?void 0:r.data.data};localStorage.setItem("shopflow_session",JSON.stringify({user:{...n},token:t}))}catch(e){p("Failed to update profile."),console.error(e)}finally{h(!1)}};return(0,r.jsxs)("div",{className:"max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-md m-10",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-6",children:"Edit Profile"}),g&&(0,r.jsx)("div",{className:"text-center text-red-500 mb-4",children:g}),(0,r.jsxs)("form",{onSubmit:v,encType:"multipart/form-data",children:[(0,r.jsxs)("div",{className:"flex items-center mb-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center",children:c?(0,r.jsx)("img",{src:c,alt:"Profile",className:"w-full h-full object-cover"}):(0,r.jsx)("span",{className:"text-3xl font-bold text-gray-500",children:i.name.charAt(0)})}),!l&&(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{let t=e.target.files[0];if(t){d(e=>({...e,profileImage:t}));let e=new FileReader;e.onloadend=()=>u(e.result),e.readAsDataURL(t)}},className:"ml-4 text-sm text-gray-600"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Name"}),(0,r.jsx)("input",{type:"text",id:"name",name:"name",value:i.name,onChange:f,className:"mt-1 p-2 w-full border border-gray-300 rounded-md",required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-amber-700",children:"Email can't be changed"}),(0,r.jsx)("input",{type:"email",id:"email",name:"email",value:i.email,onChange:f,className:"mt-1 p-2 w-full border border-gray-300 rounded-md",required:!0,disabled:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Phone"}),(0,r.jsx)("input",{type:"text",id:"phone",name:"phone",value:i.phone,onChange:f,className:"mt-1 p-2 w-full border border-gray-300 rounded-md",required:!0})]}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-6 py-2 rounded-md",disabled:m,children:m?"Saving...":"Save Changes"})})]})]})})}},e=>{var t=t=>e(e.s=t);e.O(0,[651,391,441,517,358],()=>t(9090)),_N_E=e.O()}]);