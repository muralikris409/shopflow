(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[778],{6048:(e,r,s)=>{Promise.resolve().then(s.bind(s,3601))},6046:(e,r,s)=>{"use strict";var t=s(6658);s.o(t,"useRouter")&&s.d(r,{useRouter:function(){return t.useRouter}}),s.o(t,"useSearchParams")&&s.d(r,{useSearchParams:function(){return t.useSearchParams}})},5743:(e,r,s)=>{"use strict";s.d(r,{A:()=>d});var t=s(5155),a=s(6046),o=s(2115),l=s(3391);let d=e=>r=>{let s=(0,a.useRouter)(),d=(0,l.d4)(e=>e.session.user),[n,c]=(0,o.useState)(!0);return((0,o.useEffect)(()=>{void 0!==d&&c(!1)},[d]),(0,o.useEffect)(()=>{n||d||s.push("/auth")},[n,d,s]),n)?(0,t.jsx)("div",{children:"Loading......."}):d?(0,t.jsx)(e,{...r}):null}},6301:(e,r,s)=>{"use strict";s.d(r,{S:()=>t});let t=s(2651).A.create({baseURL:"http://192.168.0.114:5000"})},3601:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>c});var t=s(5155),a=s(2115),o=s(5071),l=s(3391),d=s(5743);let n=e=>{let{order:r,onCancel:s}=e;return console.log(r),(0,t.jsx)("section",{className:"bg-white py-5 text-gray-700 sm:py-5 lg:py-5  overflow-y-hidden",children:(0,t.jsxs)("div",{className:"mx-auto max-w-screen-xl px-4 sm:px-6 lg:px-4",children:[(0,t.jsx)("div",{className:"mx-auto max-w-md text-center mb-4",children:(0,t.jsxs)("h2",{className:"font-serif text-2xl font-bold sm:text-3xl",children:["Order ID ",(0,t.jsxs)("span",{className:"text-gray-500",children:["# ",r.id]})]})}),(0,t.jsx)("div",{className:"mt-10 grid grid-cols-1 gap-6 lg:grid-cols-1 lg:gap-4",children:(0,t.jsxs)("article",{className:"relative p-4 border rounded-lg shadow-md bg-white",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-bold",children:"Order Status"}),(0,t.jsx)("div",{className:"flex items-center space-x-2",children:(0,t.jsx)("p",{className:"text-sm ".concat("OnDeliver"===r.orderStatus?"text-green-500":"text-red-500"),children:r.orderStatus})})]}),(0,t.jsx)("div",{className:"flex justify-between items-center mb-2",children:"CANCELLED"!==r.orderStatus&&(0,t.jsx)("button",{className:"px-4 py-1 bg-red-500 text-white rounded hover:bg-red-700 transition-colors duration-200",onClick:()=>{s(r.id)},children:"Cancel"})}),(0,t.jsx)("div",{className:"flex items-center space-x-4 mt-4 overflow-x-auto scroll-smooth",children:r.items.map(e=>(0,t.jsxs)("div",{className:"flex flex-col items-center min-w-[200px]",children:[(0,t.jsx)("div",{className:"aspect-square w-full overflow-hidden",children:(0,t.jsx)("img",{src:e.product.imageUrl||"/_assets/image.png",alt:e.product.name,className:"group-hover:scale-110 h-full w-full object-cover transition-all duration-300 rounded-md"})}),(0,t.jsx)("p",{className:"text-sm font-semibold text-center mt-2",children:e.product.name}),(0,t.jsxs)("p",{className:"text-sm text-center",children:["Rp ",e.price.toLocaleString()," x ",e.quantity]})]},e.id))}),(0,t.jsxs)("p",{className:"mt-4 font-bold text-lg",children:["Total: Rp ",r.totalAmount.toLocaleString()]}),"Cancelled"===r.orderStatus&&(0,t.jsx)("p",{className:"mt-2 text-red-500 font-semibold",children:"Order Cancelled"})]})})]})})},c=(0,d.A)(()=>{let[e,r]=(0,a.useState)([]),[s,d]=(0,a.useState)(!0),[c,i]=(0,a.useState)(null),u=(0,l.d4)(e=>{var r;return null===(r=e.session.user)||void 0===r?void 0:r.id});(0,a.useEffect)(()=>{(async()=>{if(u)try{d(!0);let e=await (0,o.gY)(u);r(e.orders||[])}catch(e){i((null==e?void 0:e.message)||"An error occurred")}finally{d(!1)}})()},[u]);let m=async e=>{try{await (0,o.N4)(e),r(r=>r.map(r=>r.id===e?{...r,orderStatus:"Cancelled"}:r))}catch(e){i((null==e?void 0:e.message)||"Failed to cancel order")}finally{}};return s?(0,t.jsx)("div",{className:"text-center text-lg",children:"Loading..."}):c?(0,t.jsxs)("div",{className:"text-red-500 text-center text-lg",children:["Error: ",c]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-6 text-center",children:"My Orders"}),(0,t.jsx)("div",{className:"container mx-auto p-4 max-h-lvh overflow-y-scroll my-10",children:(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4",children:e.map(e=>(0,t.jsx)(n,{order:e,onCancel:m},e.id))})})]})})},5071:(e,r,s)=>{"use strict";s.d(r,{N4:()=>n,TU:()=>l,fS:()=>a,gY:()=>d,yT:()=>o});var t=s(6301);let a=async(e,r)=>{try{return(await t.S.post("/user/order/createOrder",{userId:e,items:r})).data}catch(e){var s,a;throw console.error("Error creating order:",e),Error((null==e?void 0:null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"Error creating order.")}},o=async(e,r,s,a)=>{console.log("order_id:",e),console.log("razorpayId:",r),console.log("paymentId:",s),console.log("siign:",a);try{return(await t.S.post("/user/order/verify",{},{params:{orderId:e,razorpayId:r,paymentId:s,paymentSignature:a}})).data}catch(e){var o,l;throw console.error("Error verifying payment:",e),Error((null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(o=l.data)||void 0===o?void 0:o.message)||"Error verifying payment.")}},l=async e=>{console.log("orderid:",e);try{return(await t.S.post("/user/order/checkoutOrder?orderId=".concat(e))).data}catch(e){var r,s;throw console.error("Error fetching user orders:",e),Error((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)||"Error fetching user orders.")}},d=async e=>{console.log("userId:",e);try{return(await t.S.get("/user/order/getUserOrder?userId=".concat(e))).data}catch(e){var r,s;throw console.error("Error fetching user orders:",e),Error((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)||"Error fetching user orders.")}},n=async e=>{console.log(e);try{return(await t.S.put("/user/order/cancelOrder?orderId=".concat(e))).data}catch(e){var r,s;throw console.error("Error cancelling order:",e),Error((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)||"Error cancelling order.")}}}},e=>{var r=r=>e(e.s=r);e.O(0,[651,391,441,517,358],()=>r(6048)),_N_E=e.O()}]);