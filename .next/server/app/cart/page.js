(()=>{var e={};e.id=5,e.ids=[5],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12412:e=>{"use strict";e.exports=require("assert")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},27910:e=>{"use strict";e.exports=require("stream")},83997:e=>{"use strict";e.exports=require("tty")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},4513:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c});var s=r(70260),a=r(28203),o=r(25155),i=r.n(o),n=r(67292),l={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);r.d(t,l);let c=["",{children:["cart",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,14168)),"/home/murali/Documents/Cloning task/shopflow/src/app/cart/page.js"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,78162))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,37043)),"/home/murali/Documents/Cloning task/shopflow/src/app/layout.js"],"not-found":[()=>Promise.resolve().then(r.bind(r,26420)),"/home/murali/Documents/Cloning task/shopflow/src/app/not-found.js"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,78162))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["/home/murali/Documents/Cloning task/shopflow/src/app/cart/page.js"],u={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/cart/page",pathname:"/cart",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},85525:(e,t,r)=>{Promise.resolve().then(r.bind(r,14168))},27381:(e,t,r)=>{Promise.resolve().then(r.bind(r,17797))},17797:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var s=r(45512),a=r(58009),o=r(13319),i=r(26336),n=r(92273),l=r(79334),c=r(613);let d=()=>{let[e,t]=(0,a.useState)([]),[r,d]=(0,a.useState)(0),[m,p]=(0,a.useState)(null),[h,x]=(0,a.useState)(!1),[g,f]=(0,a.useState)(!0),y=new i.A,w=(0,n.d4)(e=>e.session.user),v=(0,l.useRouter)();(0,a.useEffect)(()=>{(async()=>{f(!0);try{if(w){let e=await y.viewCart(w.id);t(e.items),d(e.totalAmount),console.log(e)}else t([])}catch(e){p("Failed to load cart. Please try again later.")}finally{f(!1)}})()},[w]);let j=async e=>{try{if(w){await y.updateCartCount(w.id,e,"increase");let r=await y.viewCart(w.id);t(r.items),d(r.totalAmount)}else(0,o.o7)(e),t((0,o.Xl)())}catch(e){p("Failed to update item quantity. Please try again later.")}},b=async e=>{try{if(w){await y.updateCartCount(w.id,e,"decrease");let r=await y.viewCart(w.id);t(r.items),d(r.totalAmount)}else(0,o.CG)(e),t((0,o.Xl)())}catch(e){p("Failed to update item quantity. Please try again later.")}},C=async e=>{try{if(w){await y.deleteFromCart(w.id,e);let r=await y.viewCart(w.id);t(r.items),d(r.totalAmount)}else(0,o.qY)(e),t((0,o.Xl)())}catch(e){p("Failed to remove product from cart. Please try again later.")}},N=(e,t)=>{let r=encodeURIComponent(JSON.stringify({orders:e}));v.push(`/checkout?data=${r}`)},k=async()=>{x(!0);try{console.log(e);let t=e?.map(e=>({productId:e.productId,quantity:e.quantity})),{order:r}=await (0,c.fS)(w.id,t);console.log("order:",r),N(r)}catch(e){console.error(e),p("Failed to proceed with checkout. Please try again later.")}finally{x(!1)}};return(0,s.jsx)("section",{className:"h-1/3 bg-gray-100 py-12 sm:py-16 lg:py-20",children:(0,s.jsxs)("div",{className:"mx-auto px-4 sm:px-6 lg:px-8",children:[(0,s.jsx)("div",{className:"flex items-center justify-center",children:g?(0,s.jsx)("div",{className:"text-center",children:"Loading..."}):e.length>0?(0,s.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Your Cart"}):(0,s.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Your Cart is empty"})}),m&&(0,s.jsx)("div",{className:"text-center text-red-500 mt-4",children:m}),(0,s.jsx)("div",{className:"mx-auto mt-8 max-w-2xl md:mt-12",children:(0,s.jsx)("div",{className:"bg-white shadow",children:(0,s.jsxs)("div",{className:"px-4 py-6 sm:px-8 sm:py-10",children:[(0,s.jsx)("div",{className:"flow-root",children:(0,s.jsx)("ul",{className:"-my-8",children:e.map((e,t)=>(0,s.jsx)(u,{totalBill:r,product:w?e.product:e,index:t,totalPrice:e?.totalPrice,onIncreaseQuantity:j,onDecreaseQuantity:b,onRemoveProduct:C,isLoggedIn:w,quantity:w?e.quantity:null},t))})}),(0,s.jsxs)("div",{className:"mt-6 border-t border-gray-200 pt-6",children:[(0,s.jsxs)("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[(0,s.jsx)("p",{children:"Total"}),(0,s.jsxs)("p",{children:["$",w?r:e?.totalPrice]})]}),(0,s.jsxs)("div",{className:"mt-6 text-center",children:[(0,s.jsxs)("button",{type:"button",onClick:k,className:`group inline-flex w-full items-center justify-center rounded-md px-6 py-4 text-lg font-semibold text-white transition-all duration-200 ease-in-out focus:shadow ${h?"bg-gray-400 cursor-not-allowed animate-pulse":"bg-gray-900 hover:bg-gray-800"}`,disabled:0===e.length||h,children:[h?"Processing...":"Checkout",!h&&(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"group-hover:ml-8 ml-4 h-6 w-6 transition-all",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]}),0===e.length&&!g&&(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Add items to your cart to checkout"})]})]})]})})})]})})};function u({product:e=[],isLoggedIn:t,index:r,totalPrice:o,totalBill:i,onIncreaseQuantity:n,onDecreaseQuantity:l,onRemoveProduct:c,quantity:d}){let[u,m]=(0,a.useState)(!1),p=async e=>{m(!0),await n(e),m(!1)},h=async e=>{m(!0),await l(e),m(!1)};return(0,s.jsxs)("li",{className:"flex flex-col space-y-3 py-6 text-left sm:flex-row sm:space-x-5 sm:space-y-0",children:[(0,s.jsx)("div",{className:"shrink-0",children:(0,s.jsx)("img",{className:"h-24 w-24 max-w-full rounded-lg object-cover",src:e?.image||"/_assets/image.png",alt:e.name})}),(0,s.jsxs)("div",{className:"relative flex flex-1 flex-col justify-between",children:[(0,s.jsxs)("div",{className:"sm:col-gap-5 sm:grid sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"pr-8 sm:pr-5",children:[(0,s.jsx)("p",{className:"text-base font-semibold text-gray-900",children:e.name}),(0,s.jsxs)("p",{className:"mx-0 mt-1 mb-0 text-sm text-gray-400",children:["Quantity: ",t?u?"...":d:u?"...":e.quantity]})]}),(0,s.jsxs)("div",{className:"mt-4 flex items-end justify-between sm:mt-0 sm:items-start sm:justify-end",children:[(0,s.jsxs)("p",{className:"shrink-0 w-20 text-base font-semibold text-gray-900 sm:order-2 sm:ml-8 sm:text-right",children:["$",t?o:e.totalPrice?.toFixed(2)]}),(0,s.jsx)("div",{className:"sm:order-1",children:(0,s.jsxs)("div",{className:`mx-auto  rounded-md flex h-8 items-stretch text-gray-600 ${u?"border-2 border-blue-500  animate-pulse":""}`,children:[(0,s.jsx)("button",{onClick:()=>h(e.id),className:"flex items-center justify-center rounded-l-md bg-gray-200 px-4 transition hover:bg-black hover:text-white",disabled:u,children:"-"}),(0,s.jsx)("div",{className:"flex w-full items-center justify-center bg-gray-100 px-4 text-xs uppercase transition",children:u?"...":t?d:e.quantity}),(0,s.jsx)("button",{onClick:()=>p(e.id),className:"flex items-center justify-center rounded-r-md bg-gray-200 px-4 transition hover:bg-black hover:text-white",disabled:u,children:"+"})]})})]})]}),(0,s.jsx)("div",{className:"absolute top-0 right-0 flex sm:bottom-0 sm:top-auto",children:(0,s.jsx)("button",{onClick:()=>c(e.id),type:"button",className:"flex rounded p-2 text-center text-gray-500 transition-all duration-200 ease-in-out focus:shadow hover:text-gray-900",children:(0,s.jsx)("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})})]})]},r)}function m(){return(0,s.jsx)("div",{children:(0,s.jsx)(d,{})})}},13319:(e,t,r)=>{"use strict";r.d(t,{Bj:()=>n,CG:()=>d,Xl:()=>u,o7:()=>c,qY:()=>l});let s="shopflow";function a(){let e=localStorage.getItem(s);return e?JSON.parse(e):[]}function o(e){localStorage.setItem(s,JSON.stringify(e))}function i(e,t){return e.findIndex(e=>e.id===t)}function n(e){let t=a(),r=i(t,e.id);-1===r?t.push({...e,quantity:1}):t[r].quantity+=1,o(t)}function l(e){let t=a();o(t=t.filter(t=>t.id!==e))}function c(e){let t=a(),r=i(t,e);-1!==r&&(t[r].quantity+=1,o(t))}function d(e){let t=a(),r=i(t,e);-1!==r&&(t[r].quantity>1?t[r].quantity-=1:l(e),o(t))}function u(){return a()}},613:(e,t,r)=>{"use strict";r.d(t,{N4:()=>l,TU:()=>i,fS:()=>a,gY:()=>n,yT:()=>o});var s=r(85209);let a=async(e,t)=>{try{return(await s.S.post("/user/order/createOrder",{userId:e,items:t})).data}catch(e){throw console.error("Error creating order:",e),Error(e?.response?.data?.message||"Error creating order.")}},o=async(e,t,r,a)=>{console.log("order_id:",e),console.log("razorpayId:",t),console.log("paymentId:",r),console.log("siign:",a);try{return(await s.S.post("/user/order/verify",{},{params:{orderId:e,razorpayId:t,paymentId:r,paymentSignature:a}})).data}catch(e){throw console.error("Error verifying payment:",e),Error(e?.response?.data?.message||"Error verifying payment.")}},i=async e=>{console.log("orderid:",e);try{return(await s.S.post(`/user/order/checkoutOrder?orderId=${e}`)).data}catch(e){throw console.error("Error fetching user orders:",e),Error(e?.response?.data?.message||"Error fetching user orders.")}},n=async e=>{console.log("userId:",e);try{return(await s.S.get(`/user/order/getUserOrder?userId=${e}`)).data}catch(e){throw console.error("Error fetching user orders:",e),Error(e?.response?.data?.message||"Error fetching user orders.")}},l=async e=>{console.log(e);try{return(await s.S.put(`/user/order/cancelOrder?orderId=${e}`)).data}catch(e){throw console.error("Error cancelling order:",e),Error(e?.response?.data?.message||"Error cancelling order.")}}},26336:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var s=r(92273),a=r(85209);let o=function(){let e=(0,s.d4)(e=>e.session.token),t="shopflow",r=()=>({Authorization:`Bearer ${e}`,"Content-Type":"application/json"});this.loadCart=function(){let e=localStorage.getItem(t);return e?JSON.parse(e):[]},this.saveCart=function(e){localStorage.setItem(t,JSON.stringify(e))},this.migrateCart=async function(e){let t=this.loadCart();if(t.length>0){for(let r of t)try{await this.addItemToCart(e,r.productId,r.quantity)}catch(e){console.error("Error migrating cart item:",e)}this.clearCart()}},this.addItemToCart=async function(e,t,s=1){console.log(e),console.log(t);try{return(await a.S.post("/user/cart/addItemToCart",{},{params:{userId:e,productId:t,quantity:s},headers:r()})).data}catch(e){throw console.error("Error adding item to cart:",e),e.response?e.response.data:Error("Network or server error")}},this.viewCart=async function(e){try{let t=await a.S.get("/user/cart/viewCart",{params:{userId:e},headers:r()});if(200===t.status)return t.data.data||[];throw Error(t.data.message||"Failed to retrieve cart")}catch(e){throw console.error("Error viewing cart:",e),e.response?e.response.data:Error("Network or server error")}},this.deleteFromCart=async function(e,t){try{let s=await a.S.delete("/user/cart/deleteFromCart",{params:{userId:e,productId:t},headers:r()});if(200===s.status)return s.data;throw Error(s.data.message||"Failed to delete item from cart")}catch(e){throw console.error("Error deleting item from cart:",e),e.response?e.response.data:Error("Network or server error")}},this.updateCartCount=async function(e,t,s){try{let o=await a.S.put("/user/cart/cartCount",{},{params:{userId:e,productId:t,operation:s},headers:r()});if(console.log(o.status),200===o.status)return o.data;throw Error(o.data||"Failed to update cart count")}catch(e){throw console.error("Error updating cart count:",e),e}},this.clearCart=function(){localStorage.removeItem(t)}}},14168:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/murali/Documents/Cloning task/shopflow/src/app/cart/page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/murali/Documents/Cloning task/shopflow/src/app/cart/page.js","default")}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,803,140],()=>r(4513));module.exports=s})();